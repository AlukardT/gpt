# Развертывание MafiaBot на Render

## Предварительные требования

1. **Telegram Bot Token**: Получите токен у [@BotFather](https://t.me/botfather)
2. **Google Cloud Storage** (опционально): Если планируете использовать загрузку файлов
3. **Аккаунт на Render**: Зарегистрируйтесь на [render.com](https://render.com)

## Пошаговая инструкция

### 1. Подготовка репозитория

Убедитесь, что ваш код загружен в Git репозиторий (GitHub, GitLab, etc.)

### 2. Создание сервиса на Render

1. Войдите в [Render Dashboard](https://dashboard.render.com)
2. Нажмите "New +" → "Web Service"
3. Подключите ваш Git репозиторий
4. Выберите ветку для развертывания

### 3. Настройка переменных окружения

В настройках сервиса добавьте следующие переменные:

#### Обязательные:
- `BOT_TOKEN` - токен вашего Telegram бота
- `DATABASE_URL` - будет автоматически заполнен Render
- `NODE_ENV` - установите `production`
- `PORT` - установите `10000`

#### Опциональные (для Google Cloud Storage):
- `GOOGLE_CLOUD_PROJECT_ID`
- `GOOGLE_CLOUD_PRIVATE_KEY_ID`
- `GOOGLE_CLOUD_PRIVATE_KEY`
- `GOOGLE_CLOUD_CLIENT_EMAIL`
- `GOOGLE_CLOUD_CLIENT_ID`
- `GOOGLE_CLOUD_AUTH_URI`
- `GOOGLE_CLOUD_TOKEN_URI`
- `GOOGLE_CLOUD_AUTH_PROVIDER_X509_CERT_URL`
- `GOOGLE_CLOUD_CLIENT_X509_CERT_URL`

### 4. Настройка базы данных

1. В Render Dashboard создайте "PostgreSQL" базу данных
2. Убедитесь, что имя базы данных совпадает с указанным в `render.yaml`
3. Render автоматически подключит базу данных к сервису

### 5. Развертывание

1. Нажмите "Create Web Service"
2. Render автоматически:
   - Установит зависимости (`npm install`)
   - Запустит сервер (`npm start`)
   - Настроит переменные окружения
   - Подключит базу данных

### 6. Проверка работы

После успешного развертывания:
1. Проверьте логи сервиса в Render Dashboard
2. Отправьте команду `/start` вашему боту в Telegram
3. Убедитесь, что бот отвечает

## Возможные проблемы

### Ошибка "Cannot find module"
- Убедитесь, что все зависимости указаны в `package.json`
- Проверьте, что `node_modules` не загружен в Git

### Ошибка подключения к базе данных
- Проверьте, что база данных создана и запущена
- Убедитесь, что `DATABASE_URL` правильно настроен

### Бот не отвечает
- Проверьте, что `BOT_TOKEN` указан правильно
- Убедитесь, что сервер запущен и доступен
- Проверьте логи на наличие ошибок

## Мониторинг

- **Logs**: Просматривайте логи в реальном времени в Render Dashboard
- **Metrics**: Отслеживайте использование ресурсов
- **Health Checks**: Настройте проверки работоспособности

## Обновления

При каждом push в основную ветку репозитория Render автоматически:
1. Получит изменения
2. Пересоберет приложение
3. Перезапустит сервис

## Поддержка

Если возникли проблемы:
1. Проверьте логи сервиса
2. Убедитесь, что все переменные окружения настроены
3. Проверьте статус базы данных
4. Обратитесь в [Render Support](https://render.com/docs/help)