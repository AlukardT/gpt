<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞—à–∞ –ú–∞—Ñ–∏—è - –ü–æ–º–æ—â–Ω–∏–∫ –≤–µ–¥—É—â–µ–≥–æ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="game-header">
            <h1>üé≠ –ù–∞—à–∞ –ú–∞—Ñ–∏—è</h1>
        </header>

        <!-- Main Menu -->
        <div class="main-menu" id="mainMenu">
            <!-- Upcoming Event Card -->
            <div class="upcoming-event-card" id="upcomingEventCard" style="display: none;">
                <div class="event-header">
                    <h3>üéØ –ë–ª–∏–∂–∞–π—à–µ–µ —Å–æ–±—ã—Ç–∏–µ</h3>
                    <div class="event-status" id="eventStatus">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
                <div class="event-details" id="eventDetails">
                    <!-- Event details will be loaded here -->
                </div>
                <div class="event-registrations" id="eventRegistrations">
                    <!-- Registrations will be loaded here -->
                </div>
                <div class="event-actions">
                    <button class="event-btn play-btn" onclick="startGameFromEvent()" id="playEventBtn">üéÆ –ò–≥—Ä–∞—Ç—å</button>
                    <button class="event-btn load-btn" onclick="loadEventToGame()" id="loadEventBtn">üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä–æ–∫–æ–≤</button>
                    <button class="event-btn refresh-btn" onclick="refreshUpcomingEvent()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                </div>
            </div>
            
            <div class="menu-buttons">
                <button id="btn-continue" class="menu-btn primary" style="display: none; background: linear-gradient(45deg, #2ed573, #1e90ff); color: white; font-weight: bold;">‚ñ∂ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–≥—Ä—É</button>
                <button class="menu-btn" onclick="showSection('players')">üîπ –ò–≥—Ä–æ–∫–∏</button>
                <button class="menu-btn" onclick="showSection('gameSetup')">üîπ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            </div>
        </div>

        <!-- Game Table -->
        <div class="game-table-container" id="gameTable" style="display: none;">
            <div class="oval-table">
                <!-- Central control panel -->
                <div class="table-center" id="tableCenter">
                    <div class="phase-display">
                        <div class="current-phase" id="currentPhase">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞</div>
                        <div class="phase-instruction" id="phaseInstruction">–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–æ–ª–∏ –∏ –Ω–∞—á–Ω–∏—Ç–µ –∏–≥—Ä—É</div>
                    </div>
                    <div class="game-stats">
                        <div class="stat-item">
                            <span class="stat-label">–ñ–∏–≤—ã—Ö:</span>
                            <span class="stat-value" id="aliveCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">–ú–∞—Ñ–∏–∏:</span>
                            <span class="stat-value" id="mafiaAlive">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">–î–µ–Ω—å:</span>
                            <span class="stat-value" id="dayDisplay">1</span>
                        </div>
                    </div>
                    <div class="center-actions" id="centerActions">
                        <!-- Dynamic action buttons will appear here -->
                    </div>
                </div>
                
                <!-- Player seats around the oval table -->
                <div class="player-seats" id="playerSeats">
                    <!-- Players will be dynamically placed here -->
                </div>
            </div>
            
            <!-- Game Log Panel -->
            <div class="game-log-panel" id="gameLogPanel">
                <div class="log-header">
                    <h3>üìú –ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä—ã</h3>
                    <button class="log-toggle" onclick="toggleLog()">_</button>
                </div>
                <div class="log-content" id="logContent">
                    <!-- Game log entries will appear here -->
                </div>
            </div>
            
            <!-- Bottom controls -->
            <div class="bottom-controls">
                <button class="control-btn step-back" onclick="stepBack()" id="stepBackBtn" disabled>‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
                <button class="control-btn step-forward" onclick="stepForward()" id="stepForwardBtn">‚û°Ô∏è –î–∞–ª—å—à–µ</button>
                <button class="control-btn pause-btn" onclick="togglePause()" id="pauseBtn">‚è∏Ô∏è –ü–∞—É–∑–∞</button>
                <button class="control-btn rules-btn" onclick="showRules()">üìñ –ü—Ä–∞–≤–∏–ª–∞</button>
                <button class="control-btn save-btn" onclick="saveLog()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="control-btn menu-btn" onclick="showMainMenu()">üìã –ú–µ–Ω—é</button>
            </div>
        </div>

        <!-- Players Management Section -->
        <div class="section players-section" id="playersSection" style="display: none;">
            <div class="section-header">
                <h2>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏</h2>
                <button class="back-btn" onclick="showMainMenu()">üîô –ù–∞–∑–∞–¥</button>
            </div>
            
            <div class="add-player">
                <input type="text" id="playerName" placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞" class="player-input">
                <input type="text" id="playerUsername" placeholder="@username" class="player-input">
                <input type="text" id="telegramId" placeholder="Telegram ID" class="player-input">
                <input type="number" id="seatNumber" placeholder="–ú–µ—Å—Ç–æ –∑–∞ —Å—Ç–æ–ª–æ–º" class="player-input" min="1" max="20">
                <button class="add-btn" onclick="addPlayer()">‚ûï –î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
            
            <div class="test-controls" style="margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                <button class="control-btn" onclick="addTestPlayers()" style="background: linear-gradient(45deg, #2ed573, #1e90ff);">üéÆ –î–æ–±–∞–≤–∏—Ç—å 16 —Ç–µ—Å—Ç–æ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤</button>
                <button class="control-btn" onclick="clearAllPlayers()" style="background: linear-gradient(45deg, #ff6b6b, #ee5a24);">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤</button>
            </div>
            
            <div class="players-list" id="playersList">
                <!-- Players list will be displayed here -->
            </div>
        </div>

        <!-- Game Setup Section -->
        <div class="section game-setup-section" id="gameSetupSection" style="display: none;">
            <div class="section-header">
                <h2>üéÆ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–≥—Ä—ã</h2>
                <button class="back-btn" onclick="showMainMenu()">üîô –ù–∞–∑–∞–¥</button>
            </div>
            
            <div class="event-info" id="gameEventInfo" style="display: none;">
                <div class="event-info-header">
                    <h3>üéØ –ò–≥—Ä–∞ –¥–ª—è —Å–æ–±—ã—Ç–∏—è</h3>
                </div>
                <div class="event-info-content" id="gameEventDetails">
                    <!-- Event details will be shown here -->
                </div>
            </div>
            
            <div class="roles-config">
                <h3>‚ö° –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–æ–ª–µ–π</h3>
                <div id="roles-settings" class="roles-grid"></div>
                
                <div class="game-mode">
                    <h3>üé≠ –†–µ–∂–∏–º –∏–≥—Ä—ã</h3>
                    <label><input type="radio" name="gameMode" value="hidden" checked> –°–∫—Ä—ã—Ç—ã–µ —Ä–æ–ª–∏</label>
                    <label><input type="radio" name="gameMode" value="open"> –û—Ç–∫—Ä—ã—Ç—ã–µ —Ä–æ–ª–∏</label>
                </div>
                
                <button class="start-game-btn" onclick="assignRoles()">üöÄ –†–∞–∑–¥–∞—Ç—å —Ä–æ–ª–∏ –∏ –Ω–∞—á–∞—Ç—å</button>
            </div>
        </div>

        <!-- Rules Section -->
        <div class="section rules-section" id="rulesSection" style="display: none;">
            <div class="section-header">
                <h2>üìñ –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h2>
                <button class="back-btn" onclick="showMainMenu()">üîô –ù–∞–∑–∞–¥</button>
            </div>
            
            <div class="rules-content">
                <div class="rules-block">
                    <h3>üü• –†–æ–ª–∏ –º–∞—Ñ–∏–∏</h3>
                    <p><strong>–î–æ–Ω:</strong> –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –æ–± —É–±–∏–π—Å—Ç–≤–µ</p>
                    <p><strong>–ú–∞—Ñ–∏—è:</strong> –£—á–∞—Å—Ç–≤—É–µ—Ç –≤ –≤—ã–±–æ—Ä–µ –∂–µ—Ä—Ç–≤—ã</p>
                    <p><strong>–ö–æ–Ω—Å–∏–ª—å–µ—Ä–∏:</strong> –í–µ—Ä–±—É–µ—Ç –º–∏—Ä–Ω—ã—Ö –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ –º–∞—Ñ–∏–∏</p>
                    <p><strong>–ö–∞–ø–æ:</strong> –ú–æ–∂–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ä–æ–ª–µ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –¥–æ 3-–π –Ω–æ—á–∏</p>
                </div>
                
                <div class="rules-block">
                    <h3>üü¶ –ú–∏—Ä–Ω—ã–µ —Ä–æ–ª–∏</h3>
                    <p><strong>–ö–æ–º–∏—Å—Å–∞—Ä:</strong> –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–æ–ª—å –∏–≥—Ä–æ–∫–∞</p>
                    <p><strong>–î–æ–∫—Ç–æ—Ä:</strong> –õ–µ—á–∏—Ç –æ–¥–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –∑–∞ –Ω–æ—á—å</p>
                    <p><strong>–õ—é–±–æ–≤–Ω–∏—Ü–∞:</strong> –ë–ª–æ–∫–∏—Ä—É–µ—Ç —Ö–æ–¥ –∏–≥—Ä–æ–∫–∞ –Ω–∞ –Ω–æ—á—å</p>
                    <p><strong>–ü–æ–¥—Ä—ã–≤–Ω–∏–∫:</strong> –ú–∏–Ω–∏—Ä—É–µ—Ç –∏–≥—Ä–æ–∫–æ–≤, –≤–∑—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ —Å–º–µ—Ä—Ç–∏</p>
                </div>
                
                <div class="rules-block">
                    <h3>‚ö™ –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ —Ä–æ–ª–∏</h3>
                    <p><strong>–ú–∞–Ω—å—è–∫:</strong> –£–±–∏–≤–∞–µ—Ç –ª—é–±–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –∫–∞–∂–¥—É—é –Ω–æ—á—å</p>
                    <p><strong>–ö–∞–º–∏–∫–∞–¥–∑–µ:</strong> –ú–æ–∂–µ—Ç –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å —Å–æ–±–æ–π –¥–ª—è —É–±–∏–π—Å—Ç–≤–∞ –º–∞—Ñ–∏–∏</p>
                    <p><strong>–û–±–æ—Ä–æ—Ç–µ–Ω—å:</strong> –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–º–µ—Ä—Ç–∏ –≤—Å–µ–π –º–∞—Ñ–∏–∏</p>
                </div>
            </div>
        </div>

        <!-- History Section -->
        <div class="section history-section" id="historySection" style="display: none;">
            <div class="section-header">
                <h2>üìú –ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä—ã</h2>
                <button class="back-btn" onclick="showMainMenu()">üîô –ù–∞–∑–∞–¥</button>
            </div>
            
            <div class="history-content" id="historyContent">
                <p class="no-history">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞. –ù–∞—á–Ω–∏—Ç–µ –∏–≥—Ä—É —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–µ–π—Å—Ç–≤–∏—è.</p>
            </div>
        </div>

        <!-- Night Phase Panel -->
        <div class="night-panel" id="nightPanel" style="display: none;">
            <div class="night-header">
                <h3>üåô –ù–æ—á–Ω–∞—è —Ñ–∞–∑–∞</h3>
                <div class="night-step">–î–µ–Ω—å <span id="nightDayNumber"></span></div>
            </div>
            
            <div class="night-action" id="nightAction">
                <!-- Night role selector and actions will be displayed here -->
            </div>
            
            <div class="night-controls">
                <button class="night-btn" onclick="finishNight()" style="background: #e74c3c;">üåÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å –Ω–æ—á—å</button>
                <button class="night-btn" onclick="toggleNightHistory()" style="background: #3498db;">üìú –ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤</button>
            </div>
        </div>

        <!-- Night History Panel -->
        <div class="night-history-panel" id="nightHistoryPanel" style="display: none;">
            <div class="night-history-header">
                <h3>üìú –ò—Å—Ç–æ—Ä–∏—è —Ö–æ–¥–æ–≤</h3>
                <button class="close-history-btn" onclick="closeNightHistory()">‚úï</button>
            </div>
            
            <div class="night-history-content" id="nightHistoryContent">
                <!-- History entries will be displayed here -->
            </div>
        </div>

        <!-- Unified Voting Interface -->


        <div id="votingInterface" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 1000; background: rgba(0,0,0,0.95);">
            
            <!-- Header with current voter and timer -->
            <div style="background: rgba(47, 53, 66, 0.95); padding: 20px; border-bottom: 2px solid #444;">
                <div style="text-align: center;">
                    <h3 style="color: white; margin: 0;">üó≥Ô∏è –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –î–µ–Ω—å <span id="votingDayNumber"></span></h3>
                    <div id="currentVoterInfo" style="margin-top: 10px; color: #feca57;"></div>
                </div>
            </div>
            
            <!-- Players list for voting -->
            <div style="flex: 1; padding: 20px; overflow-y: auto; height: calc(100vh - 200px);">
                <div id="playersVoteList" style="max-width: 600px; margin: 0 auto;"></div>
            </div>
            
            <!-- Bottom controls -->
            <div style="background: rgba(47, 53, 66, 0.95); padding: 20px; border-top: 2px solid #444; position: absolute; bottom: 0; left: 0; right: 0;">
                <div id="votingControls" style="text-align: center; max-width: 600px; margin: 0 auto;"></div>
            </div>
            
        </div>
        
        <!-- Player Control Popup -->
        <div class="player-control-popup" id="playerControlPopup" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 350px; background: #2f3542; border-radius: 15px; padding: 25px; z-index: 1002; box-shadow: 0 10px 30px rgba(0,0,0,0.5);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h4 style="color: white; margin: 0; text-align: center; flex-grow: 1;">üíÄ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–º</h4>
                <button onclick="closePlayerControl()" style="background: transparent; color: #95a5a6; border: none; font-size: 18px; cursor: pointer; padding: 5px;">‚úï</button>
            </div>
            
            <div id="selectedPlayerInfo" style="color: #feca57; font-size: 16px; text-align: center; margin-bottom: 20px; min-height: 25px; font-weight: bold;"></div>
            
            <div style="text-align: center;">
                <button onclick="killSelectedPlayer()" id="killBtn" style="background: #ff4757; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-bottom: 15px; font-size: 14px;" disabled>
                    üíÄ –£–±–∏—Ç—å –∏–≥—Ä–æ–∫–∞
                </button>
                <button onclick="reviveSelectedPlayer()" id="reviveBtn" style="background: #2ed573; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; font-size: 14px;" disabled>
                    üíö –í–µ—Ä–Ω—É—Ç—å –∫ –∂–∏–∑–Ω–∏
                </button>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="closePlayerControl()" style="background: #57606f; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold;">
                    –ó–∞–∫—Ä—ã—Ç—å
                </button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>